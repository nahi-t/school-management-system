{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { environment, getApiUrl, getFallbackApiUrl } from '../../environments/environment.prod';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"./storage.service\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor(http, router, storageService) {\n      this.http = http;\n      this.router = router;\n      this.storageService = storageService;\n      this.apiUrl = environment.production ? getApiUrl() : getFallbackApiUrl();\n      this.currentUserSubject = new BehaviorSubject(null);\n      this.currentUser = this.currentUserSubject.asObservable();\n      this.initializeAuth();\n    }\n    initializeAuth() {\n      console.log('AuthService: Initializing authentication...');\n      const storedUser = this.storageService.getUser();\n      if (storedUser) {\n        this.currentUserSubject.next(storedUser);\n        console.log('AuthService: User restored from storage:', storedUser);\n      } else {\n        console.log('AuthService: No stored user found');\n      }\n    }\n    get currentUserValue() {\n      return this.currentUserSubject.value;\n    }\n    login(email, password) {\n      const apiUrl = `${this.apiUrl}/login`;\n      console.log('AuthService: Login API URL:', apiUrl);\n      console.log('AuthService: Login payload:', {\n        email,\n        password\n      });\n      const headers = {\n        'Content-Type': 'application/json'\n      };\n      console.log('AuthService: Request headers:', headers);\n      return this.http.post(apiUrl, {\n        email,\n        password\n      }, {\n        headers\n      }).pipe(map(response => {\n        const user = response.user;\n        user.token = response.token;\n        // Store user with timestamp for debugging\n        const userWithTimestamp = {\n          ...user,\n          loginTime: new Date().toISOString()\n        };\n        this.storageService.setUser(userWithTimestamp);\n        this.currentUserSubject.next(userWithTimestamp);\n        console.log('AuthService: User logged in:', userWithTimestamp);\n        return userWithTimestamp;\n      }));\n    }\n    register(name, email, password, role) {\n      const apiUrl = `${this.apiUrl}/register`;\n      console.log('AuthService: Register API URL:', apiUrl);\n      console.log('AuthService: Register payload:', {\n        name,\n        email,\n        password,\n        role\n      });\n      const headers = {\n        'Content-Type': 'application/json'\n      };\n      console.log('AuthService: Request headers:', headers);\n      return this.http.post(apiUrl, {\n        name,\n        email,\n        password,\n        role\n      }, {\n        headers\n      }).pipe(map(response => {\n        const user = response.user;\n        user.token = response.token;\n        this.storageService.setUser(user);\n        this.currentUserSubject.next(user);\n        return user;\n      }));\n    }\n    logout() {\n      this.storageService.removeUser();\n      this.currentUserSubject.next(null);\n      this.router.navigate(['/login']);\n    }\n    isLoggedIn() {\n      const currentUser = this.currentUserSubject.value;\n      if (!currentUser) return false;\n      // Check if token exists and is not expired\n      const token = currentUser.token;\n      if (!token) return false;\n      try {\n        // Basic token validation (you can enhance this with JWT decoding)\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        const now = Date.now() / 1000;\n        return payload.exp > now;\n      } catch (error) {\n        console.error('Token validation error:', error);\n        return false;\n      }\n    }\n    hasRole(role) {\n      return this.currentUserValue?.role === role;\n    }\n    hasAnyRole(roles) {\n      return roles.includes(this.currentUserValue?.role || '');\n    }\n    getToken() {\n      return this.currentUserValue?.token || null;\n    }\n    static {\n      this.ɵfac = function AuthService_Factory(t) {\n        return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.StorageService));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AuthService,\n        factory: AuthService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}